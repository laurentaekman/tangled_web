import type { NextPage } from "next";
import Head from "next/head";
import Link from "next/link";
import { useContext, useEffect, useState } from "react";
import styles from "../styles/WelcomePage.module.css";
import ObjectsContext from "../context/objects-context";
import { getArtObject } from "../utils/api";
import { useFavorites } from "../hooks/use-favorites";
import { ArtObject } from "../utils/types";
import { RightArrowIcon } from "../assets/RightArrowIcon";

const WelcomePage: NextPage = () => {
  const initialObjectIdArray: number[] = [];
  const initialObjectArray: any[] = [];

  const [startingObjectIds, setStartingObjectIds] =
    useState(initialObjectIdArray);
  const [startingObjects, setStartingObjects] = useState(initialObjectArray);
  const [artObject, setArtObject] = useState<ArtObject>();
  const [isLoading, setIsLoading] = useState(false);
  const [favorites] = useFavorites();
  const objectsContext = useContext(ObjectsContext);

  useEffect(() => {
    let newObject;
    const objectIds: number[] = objectsContext.objectWithImagesIds;
    if (favorites.length > 0) {
      newObject = favorites.find((favorite: ArtObject) => favorite.imageSource);
    }

    const getObject = async () => {
      let object;
      const randomIndex = Math.floor(
        Math.random() * (objectIds.length - 0 + 1)
      );
      object = await getArtObject(objectIds[randomIndex]);
      setArtObject(object);
    };

    if (!newObject && objectIds.length > 0) {
      getObject();
    } else {
      setArtObject(newObject);
    }
  }, [favorites, objectsContext.objectWithImagesIds]);

  return (
    <div>
      <Head>
        <title>Tangled Web</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className={styles.main}>
        {artObject?.imageSource && (
          <div className={styles.main_cropped_image}>
            <img src={artObject.imageSource} />
          </div>
        )}
        <div className={styles.main_text}>
          <h1>Tangled Web</h1>
          <h2>
            Explore a variety of pieces from the Metropolitan Museum of Art.
          </h2>
          <Link href="/home">
            <a>
              Get Started
              <RightArrowIcon />
            </a>
          </Link>
        </div>
      </main>
    </div>
  );
};

export default WelcomePage;
